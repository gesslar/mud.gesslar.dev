<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUD Tools and Mudlet Packages</title>
    <!-- Include Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Ensure the GitHub icon link is always black */
        .github-icon-link {
            color: black;
        }
        .github-icon-link:hover {
            color: black;
        }
    </style>
</head>
<body>
    <div>
        <h1>MUD tools for ThresholdRPG</h1>
        <ul id="tools-list">
        </ul>
    </div>
    <div>
        <h1>Mudlet Packages</h1>
        <p>To install these packages in Mudlet, simply drag and drop the links onto Mudlet. Ensure you're at least at Mudlet v4.13.1</p>
        <ul id="package-list">
        </ul>
    </div>

    <p>Click on the GitHub <i class="fab fa-github"></i> link to visit the repository. There might be help there. Or not. It depends.</p>
    <script>
        // Function to fetch dynamic repositories from GitHub
        async function fetchGitHubRepositories(username, topic) {
            const url = `https://api.github.com/search/repositories?q=user:${username}+topic:${topic}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.items.map(repo => ({
                name: repo.name,
                description: repo.description || 'No description provided',
                html_url: repo.html_url
            }));
        }

        // Function to get all current packages from the list
        function getCurrentPackages() {
            const packageList = document.getElementById('package-list');
            const packageItems = packageList.querySelectorAll('li');
            const packages = [];

            packageItems.forEach(item => {
                const link = item.querySelector('a');
                const name = link.textContent.replace('.mpackage', '');
                const description = item.textContent.match(/\(([^)]+)\)/)[1];
                const isStatic = item.getAttribute('data-static') === 'true';
                const html_url = isStatic ? null : item.querySelector('a').href;
                packages.push({ name, description, html_url, isStatic });
            });

            return packages;
        }

        // Function to display repositories
        function displayRepositories(repositories, listId, linkPrefix) {
            // Sort repositories by name
            repositories.sort((a, b) => a.name.localeCompare(b.name));

            const list = document.getElementById(listId);
            list.innerHTML = ''; // Clear existing list

            repositories.forEach(repo => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                const cleanedName = repo.name.replace(/_/g, ' '); // Replace underscores with spaces
                link.href = `${linkPrefix}${repo.name}`;
                link.textContent = cleanedName;
                listItem.appendChild(link);
                listItem.append(` (${repo.description}) `);

                // Add GitHub icon link
                const iconLink = document.createElement('a');
                iconLink.href = repo.html_url;
                iconLink.target = "_blank"; // Open in a new tab
                iconLink.className = 'github-icon-link';
                iconLink.innerHTML = '<i class="fab fa-github"></i>';
                listItem.appendChild(iconLink);

                list.appendChild(listItem);
            });
        }

        // Combine static and dynamic packages and display them
        async function loadPackages() {
            const username = 'gesslar';
            const packageTopic = 'mudlet-package';
            const toolsTopic = 'mud-tools';

            // Fetch dynamic packages from GitHub
            const dynamicPackages = await fetchGitHubRepositories(username, packageTopic);

            // Fetch dynamic tools from GitHub
            const dynamicTools = await fetchGitHubRepositories(username, toolsTopic);

            // Get current static packages
            const staticPackages = getCurrentPackages().filter(pkg => pkg.isStatic);

            // Combine static and dynamic packages
            const allPackages = [...staticPackages, ...dynamicPackages];

            // Display packages
            displayRepositories(allPackages, 'package-list', 'https://github.com/gesslar/');

            // Display tools
            displayRepositories(dynamicTools, 'tools-list', './');
        }

        // Load packages and tools on page load
        loadPackages();
    </script>
</body>
</html>
